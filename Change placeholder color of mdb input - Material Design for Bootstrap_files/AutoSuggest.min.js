(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.AutoSuggest=t()})(this,function(){"use strict";function e(e){return[].concat(e).map(function(e){var t=void 0===e?"undefined":i(e);if("string"===t)e={on:[e],show:e,use:e,focus:[0,0]};else if("object"===t){try{d("Suggestion",e,"value"),u("Suggestion",e,"value","string")}catch(t){if(t instanceof TypeError)throw t;try{d("Suggestion",e,["on","show","use"])}catch(n){throw e.on||e.show||e.use?n:t}u("Suggestion",e,"on","string"),u("Suggestion",e,"use","string"),u("Suggestion",e,"show","string")}e.show=e.show||e.value,e.use=e.use||e.value,e.on=[e.show].concat(e.on||e.value),e.focus=e.focus||[0,0],e.focus.constructor!==Array&&(e.focus=[e.focus,e.focus])}return e})}function t(t){t&&!t.values&&(t={values:t});try{d("SuggestionList",t,"trigger"),u("Suggestion",t,"trigger","string")}catch(e){if(e instanceof TypeError)throw e}if(d("SuggestionList",t,"values"),t.caseSensitive=Boolean(t.caseSensitive),"function"==typeof t.values?this.getSuggestions=function(n,o){t.values(n,function(t){return o(e(t))})}:t.values.constructor!==Array&&"string"!=typeof t.values||(t.values=e(t.values),this.getSuggestions=function(e,n){var o=new RegExp("^"+e,t.caseSensitive?"":"i");n(t.values.filter(function(t){for(var n=!1,i=0;i<t.on.length&&(t.on[i]===e||!(n=o.test(t.on[i])));i++);return n}))}),this.trigger=t.trigger,this.trigger){var n="\\"+this.trigger.split("").join("\\");this.regex=new RegExp("(?:^|[^"+n+"]+?)"+n+"(\\S*)$")}else this.regex=new RegExp("(?:^|\\W+)(\\w+)$")}function n(e,t,n){var o=e.slice(0,t),i=o.split(n||/\W/).pop(),r=i.length?o.slice(0,0-i.length):o;return i+=e.slice(t),{textAfterTrigger:i,textUptoTrigger:r}}function o(e,t){if(y(e,"isInput")){var o=h(e),i=a(o,1),r=i[0],s=n(e.value,r,t),d=s.textAfterTrigger,u=s.textUptoTrigger,v=document.createElement("pre");v.id="autosuggest-positionclone";var w=document.createElement("span");w.appendChild(document.createTextNode(C)),v.appendChild(document.createTextNode(u.replace(/ /g," "))),v.appendChild(w),v.appendChild(document.createTextNode(d.replace(/ /g," "))),l(e,v);var m=f(e);v.style.opacity=0,v.style.position="absolute",v.style.top=m.top+"px",v.style.left=m.left+"px",document.body.appendChild(v),"INPUT"===e.tagName?(v.style.overflowX="auto",v.style.whiteSpace="nowrap",r===e.value.length?v.scrollLeft=v.scrollWidth-v.clientWidth:v.scrollLeft=Math.min(p(e),v.scrollWidth-v.clientWidth)):(v.style.maxWidth="100%",v.style.whiteSpace="pre-wrap",v.scrollTop=e.scrollTop,v.scrollLeft=e.scrollLeft);var S=f(w);S.left-=v.scrollLeft;var E=parseFloat(c(w,"line-height"));return S.top+=E-v.scrollTop,document.body.removeChild(v),S}var A=window.getSelection().getRangeAt(0),x=A.startContainer,T=A.startOffset,L=A.endContainer,b=A.endOffset,N=g(),k=N.startContainer,O=N.startOffset,H=n(k.nodeValue,O,t),I=H.textAfterTrigger,R=H.textUptoTrigger,P=k.parentNode,V=k.nextSibling,W=document.createElement("span");if(W.appendChild(document.createTextNode(C)),P.insertBefore(W,V),I){k.nodeValue=R;var U=document.createTextNode(I);P.insertBefore(U,V)}var D=f(W),B=parseFloat(c(W,"line-height"));D.top+=B,P.removeChild(W),I&&(P.removeChild(k.nextSibling),k.nodeValue=R+I);var K=window.getSelection().getRangeAt(0);return K.setStart(x,T),K.setEnd(L,b),D}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=function(){function e(e,t){var n=[],o=!0,i=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);o=!0);}catch(e){i=!0,r=e}finally{try{!o&&a.return&&a.return()}finally{if(i)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(e,t,n){[].concat(n).forEach(function(n){if(void 0===t[n])throw new Error("AutoSuggest: Missing required parameter, "+e+"."+n)})},u=function(e,t,n,o){[].concat(t[n]).forEach(function(t){if((void 0===t?"undefined":i(t))!==o)throw new TypeError("AutoSuggest: Invalid Type for "+e+"."+n+", expected "+o)})},l=function(e,t){var n=window.getComputedStyle(e);for(var o in n)n.hasOwnProperty(o)&&t.style.setProperty(o,n[o])},c=function(e,t){return window.getComputedStyle(e).getPropertyValue(t)},f=function(e){var t=e,n=0,o=0;do{o+=t.offsetLeft,n+=t.offsetTop}while(t=t.offsetParent);return{left:o,top:n}},p=function(e){if(e.createTextRange){var t=e.createTextRange(),n=window.getComputedStyle(e),o=parseFloat(n.paddingLeft),i=t.getBoundingClientRect();return e.getBoundingClientRect().left+e.clientLeft+o-i.left}return e.scrollLeft},h=function(e){return[e.selectionStart,e.selectionEnd].sort(function(e,t){return e-t})},g=function(){var e=window.getSelection().getRangeAt(0),t=e.startContainer,n=e.startOffset;if(t.nodeType!==t.TEXT_NODE){for(t=t.childNodes[n];t&&t.nodeType!==t.TEXT_NODE;)t=t.firstChild;n=0}var o=e.endContainer,i=e.endOffset;if(o.nodeType!==o.TEXT_NODE){for(o=o.childNodes[i];o&&o.nodeType!==o.TEXT_NODE;)o=o.lastChild;i=o?o.nodeValue.length:o}return{startContainer:t,startOffset:n,endContainer:o,endOffset:i}},v=function(){var e=0,t=[];return function(n,o){for(t[o-e]=n;t[0];)++e,t.shift()()}},y=function(e,t,n){if(t="autosuggest_"+t,void 0===n)return n=e.dataset[t],void 0!==n?JSON.parse(e.dataset[t]):n;e.dataset[t]=JSON.stringify(n)},w=function(e){var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild};t.prototype.getMatch=function(e){return e.match(this.regex)[1]};var m=function(){function e(){r(this,e),this.width=0,this.isEmpty=!0,this.isActive=!1,this.dropdownContent=document.createElement("div"),this.dropdownContent.className="dropdown-menu dropdown-info dropdown-menu-left",this.dropdown=document.createElement("div"),this.dropdown.className="dropdown open",this.dropdown.style.position="absolute",this.hide(),this.dropdown.appendChild(this.dropdownContent),document.body.appendChild(this.dropdown)}return s(e,[{key:"show",value:function(e){e&&(this.dropdown.style.left=e.left+"px",this.dropdown.style.top=e.top+"px",e.left+this.width>document.body.offsetWidth?(this.dropdownContent.classList.remove("dropdown-menu-left"),this.dropdownContent.classList.add("dropdown-menu-right")):(this.dropdownContent.classList.remove("dropdown-menu-right"),this.dropdownContent.classList.add("dropdown-menu-left"))),this.dropdown.style.display="block",this.isActive=!0}},{key:"hide",value:function(){this.dropdown.style.display="none",this.isActive=!1}},{key:"empty",value:function(){this.dropdownContent.innerHTML="",this.isEmpty=!0}},{key:"fill",value:function(e,t){var n=this;this.empty(),e.forEach(function(e){var o=w('<a class="dropdown-item">'+e.show+"</a>");n.dropdownContent.append(o),y(o,"suggestion",e),o.addEventListener("mouseenter",function(){n.getActive().classList.remove("active"),o.classList.add("active")}),o.addEventListener("mousedown",function(o){t(e),n.hide(),o.preventDefault(),o.stopPropagation()})}),this.isActive||this.show(),this.width=this.dropdownContent.offsetWidth,this.isActive||this.hide(),this.setActive(),this.isEmpty=!1}},{key:"showLoader",value:function(e){this.empty(),this.dropdownContent.innerHTML='<div class="autosuggest-loader">Loading...</div>',this.show(e)}},{key:"getActive",value:function(){for(var e=Array.prototype.slice.call(this.dropdownContent.querySelectorAll("a.active"),0);e[1];)e.pop().classList.remove("active");return e[0]}},{key:"getValue",value:function(e){return y(e||this.getActive(),"suggestion")}},{key:"setActive",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.dropdownContent.firstElementChild,t=arguments[1];t&&t.classList.remove("active"),e.classList.add("active")}},{key:"selectNext",value:function(){var e=this.getActive(),t=e.nextElementSibling||this.dropdownContent.firstElementChild;this.setActive(t,e)}},{key:"selectPrev",value:function(){var e=this.getActive(),t=e.previousElementSibling||this.dropdownContent.lastElementChild;this.setActive(t,e)}}]),e}(),C="\ufeff",S=function(e){for(var t=e.nextSibling||e.parentNode.nextSibling;t.firstChild;)t=t.firstChild;return t},E=function(e){var t=e.element,n=e.trigger,o=e.suggestion,i=e.onChange,r=o.use,s=o.focus;if(y(t,"isInput")){var d=h(t),u=a(d,2),l=u[0],c=u[1],f=t.value,p=f.slice(0,l),v=p.split(n||/\W/).pop();p=p.slice(0,0-v.length-(n||"").length)+r,t.value=p+f.slice(c),t.focus();var w=p.length;t.setSelectionRange(w+s[0],w+s[1])}else{var m=g(),C=m.startContainer,E=m.startOffset,A=m.endContainer,x=m.endOffset,T=C.nodeValue.slice(0,E),L=T.split(n||/\W/).pop();T=T.slice(0,0-L.length-(n||"").length)+r,C.nodeValue=T+A.nodeValue.slice(x);var b=C;for(b!==A&&(b=S(C));b!==A;)b.parentNode.removeChild(b),b=S(C);A.parentNode.removeChild(A);var N=T.length,k=window.getSelection().getRangeAt(0);k.setStart(C,N+s[0]),k.setEnd(C,N+s[1])}i(t,o)},A=function(){function e(n){if(r(this,e),!n)throw new Error("AutoSuggest: Missing required parameter, options");this.inputs=[],this.dropdown=new m,this.onChange=n.onChange||Function.prototype,this.maxSuggestions=n.maxSuggestions||10,this.suggestionLists=n.suggestions||[];for(var i=0;i<this.suggestionLists.length;i++){var s=this.suggestionLists[i];s instanceof t||(s.constructor!==Object&&(s={values:s}),!s.hasOwnProperty("caseSensitive")&&n.hasOwnProperty("caseSensitive")&&(s.caseSensitive=n.caseSensitive),this.suggestionLists[i]=new t(s))}var d=this,u=null,l=!1;this.onBlurHandler=function(){d.dropdown.hide()},this.onKeyDownHandler=function(e){if(l=!1,d.dropdown.isActive){var t=function(){e.preventDefault(),l=!0};if(13===e.keyCode||9===e.keyCode)return E({element:this,trigger:u.trigger,suggestion:d.dropdown.getValue(),onChange:d.onChange}),d.dropdown.hide(),t();if(40===e.keyCode)return d.dropdown.selectNext(),t();if(38===e.keyCode)return d.dropdown.selectPrev(),t();if(27===e.keyCode)return d.dropdown.hide(),t()}};var c=0;this.onKeyUpHandler=function(){var e=this;if(!l){var t=void 0;if(y(this,"isInput")){var n=h(this),i=a(n,2),r=i[0],s=i[1];if(/[a-zA-Z_0-9]/.test(this.value.charAt(s)||" "))return void d.dropdown.hide();t=this.value.slice(0,r)}else{var f=g(),p=f.startContainer,w=f.startOffset,m=f.endContainer,C=f.endOffset;if(!p||!m||/[a-zA-Z_0-9]/.test(m.nodeValue.charAt(C)||" "))return void d.dropdown.hide();t=p.nodeValue.slice(0,w)}(function(){c++,d.dropdown.empty();var n=v(),i=0,r=void 0,s=!1,a=function(a){a.regex.test(t)&&(s=!0,function(i,s){var l=a.getMatch(t),f=o(e,a.trigger);d.dropdown.isEmpty&&(r&&clearTimeout(r),r=setTimeout(function(){d.dropdown.showLoader(f)},0)),a.getSuggestions(l,function(t){s===c&&n(function(){r&&clearTimeout(r),d.dropdown.isEmpty&&(t.length?(u=a,d.dropdown.fill(t.slice(0,d.maxSuggestions),function(t){E({element:e,trigger:a.trigger,suggestion:t,onChange:d.onChange})}),d.dropdown.show(f)):d.dropdown.hide())},i)})}(i++,c))},l=!0,f=!1,p=void 0;try{for(var h,g=d.suggestionLists[Symbol.iterator]();!(l=(h=g.next()).done);l=!0){var y=h.value;a(y)}}catch(e){f=!0,p=e}finally{try{!l&&g.return&&g.return()}finally{if(f)throw p}}s||d.dropdown.hide()})()}};for(var f=arguments.length,p=Array(f>1?f-1:0),w=1;w<f;w++)p[w-1]=arguments[w];this.addInputs.apply(this,p)}return s(e,[{key:"addInputs",value:function(){for(var e=this,t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];var i=Array.prototype.concat.apply([],n.map(function(e){return e[0]?Array.prototype.slice.call(e,0):e}));i.forEach(function(t){if(t.isContentEditable)y(t,"isInput",!1);else{if("TEXTAREA"!==t.tagName&&("INPUT"!==t.tagName||"text"!==t.type))throw new Error("AutoSuggest: Invalid input: only input[type = text], textarea and contenteditable elements are supported");y(t,"isInput",!0)}t.addEventListener("blur",e.onBlurHandler),t.addEventListener("keyup",e.onKeyUpHandler),t.addEventListener("click",e.onKeyUpHandler),t.addEventListener("keydown",e.onKeyDownHandler,!0),y(t,"index",e.inputs.push(t)-1)})}},{key:"removeInputs",value:function(){for(var e=this,t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];var i=Array.prototype.concat.apply([],n.map(function(e){return e[0]?Array.prototype.slice.call(e,0):e}));i.forEach(function(t){var n=y(t,"index");isNaN(n)||(e.inputs.splice(n,1),t.removeEventListener("blur",e.onBlurHandler),t.removeEventListener("keyup",e.onKeyUpHandler),t.removeEventListener("click",e.onKeyUpHandler),t.removeEventListener("keydown",e.onKeyDownHandler,!0))})}},{key:"destroy",value:function(){this.removeInputs(this.inputs)}}]),e}();return A});